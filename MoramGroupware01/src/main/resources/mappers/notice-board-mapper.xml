<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC 	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>	

<mapper namespace="NoticeBoardMapper">
	<insert id = "insert">
	insert into Moram_info_board(title, content, userid)
	values(#{title},#{content},#{userid})
	</insert>
	
	<select id = "selectAll" resultType="project.spring.groupware.board.domain.BoardVO">
	select * from Moram_info_board
	order by bno desc
	</select>
	
	<select id = "selectByBno" resultType="project.spring.groupware.board.domain.BoardVO">
	select * from Moram_info_board
	where bno = #{bno}
	</select>
	
	<update id="update">
	update Moram_info_board set title=#{title}, content=#{content}, regdate=sysdate
	where bno=#{bno}
	</update>
	
	<delete id = "delete">
	delete from Moram_info_board where bno=#{bno}
	</delete>
	
	<select id = "totalCount" resultType="Integer">
	select count (*) from Moram_info_board
	</select>
	
	<select id = "listPage" resultType = "project.spring.groupware.board.domain.BoardVO">
	select b.bno, b.title, b.content, b.userid, b.regdate, b.replycnt, b.viewcnt
	from(
		select rownum rn, a.* from(
			select * from Moram_info_board
			order by bno desc
		)a
		
	)b
	where rn between #{start} and #{end}
	</select>

	<!-- 게시글 검색을 위한 SQL 문 -->
	<sql id="dynamicSearchCondition">
		<if test = "searchType != null">
			<if test = "searchType == 't'.toString()">
			where title like '%'||#{keyword}||'%'
			</if>
			<if test = "searchType == 'u'.toString()">
			where userid like '%'||#{keyword}||'%'
			</if>			
		</if>
	</sql>
	
	<select id="listSearchCriteria" resultType = "project.spring.groupware.board.domain.BoardVO">
	select b.*
	from(
		select rownum rn, a.* from(
			select * from Moram_info_board
			order by bno desc
		)a
	<include refid="dynamicSearchCondition"></include>	
	)b
	where rn between #{start} and #{end}
	</select>
	
	<!-- reviewcnt -->
	<update id="viewcnt">
	update Moram_info_board set viewcnt = viewcnt + 1
	where bno = #{bno}
	</update>
	
	   <!-- 검색했을 때 페이징 -->
   <select id="searchTotalCount" resultType="Integer">
   select count(*) from Moram_info_board
   <include refid="dynamicSearchCondition"/>
   </select>
	
</mapper>